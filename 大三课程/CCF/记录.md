è¿™å¥è¯å¼ºè°ƒäº†åœ¨ä¼˜åŒ– RAGï¼ˆRetrieval-Augmented Generationï¼‰æµç¨‹æ—¶ï¼Œåº”è¯¥é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ä¸ªç¯èŠ‚ï¼šæ–‡æœ¬è§£æã€æ–‡æœ¬åˆ‡ç‰‡ã€æ£€ç´¢è¿‡æ»¤å’Œæ’åºã€‚ä»¥ä¸‹æ˜¯æœ¬æ–‡ä»¶ä»£ç ä¸­ä¸è¿™äº›ç¯èŠ‚ç›¸å…³çš„éƒ¨åˆ†ï¼š

1. **æ–‡æœ¬è§£æ**ï¼š
   - ä»£ç ä¸­ä½¿ç”¨ `PyPDFDirectoryLoader` è§£æ PDF æ–‡æ¡£ï¼Œå¹¶å°†å…¶å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚
   - ç¤ºä¾‹ä»£ç ï¼š
     ```python
     loader = PyPDFDirectoryLoader(DOCS_DIR)
     pages = loader.load_and_split()
     ```

2. **æ–‡æœ¬åˆ‡ç‰‡**ï¼š
   - ä½¿ç”¨ `RecursiveCharacterTextSplitter` å¯¹æ–‡æœ¬è¿›è¡Œåˆ‡ç‰‡ï¼Œå°†é•¿æ–‡æœ¬åˆ†å‰²æˆè¾ƒå°çš„å—ï¼Œä»¥ä¾¿åç»­å¤„ç†ã€‚
   - ç¤ºä¾‹ä»£ç ï¼š
     ```python
     text_splitter = RecursiveCharacterTextSplitter(
         chunk_size=300,
         chunk_overlap=100,
         separators=["ã€‚", "ï¼", "ï¼Ÿ"],
         keep_separator='end',
     )
     docs = text_splitter.split_documents(documents)
     ```

3. **æ£€ç´¢è¿‡æ»¤**ï¼š
   - ä½¿ç”¨ BM25 å’Œå¯†é›†å‘é‡æ£€ç´¢å™¨ï¼ˆDense Retrieverï¼‰è¿›è¡Œæ£€ç´¢ï¼Œå¹¶ç»“åˆä¸¤è€…çš„ç»“æœã€‚
   - ç¤ºä¾‹ä»£ç ï¼š
     ```python
     dense_retriever = vectordb.as_retriever(search_kwargs={"k": 5})
     bm25_retriever = BM25Retriever.from_documents(
         docs,
         k=5,
         bm25_params={"k1": 1.6, "b": 0.75},
         preprocess_func=jieba.lcut
     )
     ensemble_retriever = EnsembleRetriever(retrievers=[bm25_retriever, dense_retriever], weights=[0.4, 0.6])
     ```

4. **æ’åº**ï¼š
   - ä½¿ç”¨ `CrossEncoderReranker` å¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œé‡æ’åºï¼Œä»¥æé«˜ç›¸å…³æ€§ã€‚
   - ç¤ºä¾‹ä»£ç ï¼š
     ```python
     def rerank(questions, retriever, top_n=1, cut_len=384):
         rerank_model = HuggingFaceCrossEncoder(model_name=RERANK_MODEL)
         compressor = CrossEncoderReranker(model=rerank_model, top_n=top_n)
         compression_retriever = ContextualCompressionRetriever(
             base_compressor=compressor, base_retriever=retriever
         )
         rerank_answers = []
         for question in tqdm(questions):
             relevant_docs = compression_retriever.invoke(question)
             answer = ''
             for rd in relevant_docs:
                 answer += rd.page_content
             rerank_answers.append(answer[:245])
         return rerank_answers
     ```

è¿™äº›ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•è§£ææ–‡æ¡£ã€åˆ‡ç‰‡æ–‡æœ¬ã€è¿›è¡Œæ£€ç´¢å’Œæ’åºï¼Œä»¥ä¼˜åŒ– RAG æµç¨‹ã€‚

## è¯„åˆ†
â€¢ **é—®é¢˜è¯„åˆ†**
å¯¹äºä»»æ„é—®é¢˜ï¼Œé‡‡ç”¨å¦‚ä¸‹å…¬å¼è¯„åˆ†ï¼š

**score ğ‘–=[\*i\*=[ weight ğ‘–ğ‘˜ğ‘¤Ã—\*i\**k\**w\*Ã— score ğ‘–ğ‘˜ğ‘¤+(1âˆ’\*i\**k\**w\*+(1âˆ’ weight ğ‘–ğ‘˜ğ‘¤)Ã—\*i\**k\**w\*)Ã— score ğ‘–ğ‘’ğ‘ ]Ã—ğ‘ğ‘–\*i\**e\**s\*]Ã—\*p\**i\***

**scoreikw**: å…³é”®è¯è¯„åˆ†ã€‚å‡ºé¢˜æ–¹ä¸ºæ¯é¢˜æ ‡æ³¨äº†è‹¥å¹²ç­”æ¡ˆå…³é”®è¯ï¼Œé€‰æ‰‹æäº¤æ–‡ä»¶çš„answeråˆ—ä¸­å‡†ç¡®åŒ…å«æ‰€æœ‰å…³é”®è¯å¾—1åˆ†ï¼ŒåŒ…å«éƒ¨åˆ†å…³é”®è¯åˆ™æŒ‰æ¯”ä¾‹å¾—åˆ†ã€‚
**scoreies** ï¼šå‘é‡ç›¸ä¼¼åº¦è¯„åˆ†ã€‚å‡ºé¢˜æ–¹ä¸ºæ¯é¢˜æ ‡æ³¨äº†ç­”æ¡ˆæ‰€åœ¨æ–‡æœ¬å—ï¼Œæ ¹æ®é€‰æ‰‹æäº¤æ–‡ä»¶ä¸­embeddingåˆ—ä¸æ ‡æ³¨æ–‡æœ¬å—å‘é‡è¡¨ç¤ºçš„ä½™å¼¦ç›¸ä¼¼åº¦æ‰“åˆ†ï¼Œå®Œå…¨ä¸€è‡´å¾—1åˆ†ã€‚
**weightikw** ï¼šå…³é”®è¯è¯„åˆ†å æ€»è¯„åˆ†çš„æƒé‡ã€‚é€šå¸¸ä¸º0.1è‡³0.9ä¹‹é—´çš„æƒé‡ï¼Œè¡¨æ ¼æŸ¥æ•°é—®é¢˜çš„å…³é”®è¯å¾—åˆ†æƒé‡ä¸º1ã€‚
**pi**ï¼šé•¿åº¦æƒ©ç½šé¡¹ã€‚æ ¹æ®é€‰æ‰‹ answer çš„é•¿åº¦ ğ‘™ğ‘’ğ‘›ğ‘–ğ‘ ğ‘¢ğ‘*l**e**n**i**s**u**b*â€‹ ä¸æ ‡æ³¨æ–‡æœ¬å—é•¿åº¦ ğ‘™ğ‘’ğ‘›ğ‘–ğ‘ ğ‘¡ğ‘‘*l**e**n**i**s**t**d*â€‹ ç¡®å®š, ğ‘™ğ‘’ğ‘›ğ‘–sub â‰¤1.5ğ‘™ğ‘’ğ‘›ğ‘–std *l**e**n**i*sub â€‹â‰¤1.5*l**e**n**i*std â€‹ æ—¶è¯¥é¡¹ä¸º 1;1.51;1.5 len ğ‘–std <ğ‘™ğ‘’ğ‘›ğ‘–sub â‰¤2.5ğ‘™ğ‘’ğ‘›ğ‘–std *i*std â€‹<*l**e**n**i*sub â€‹â‰¤2.5*l**e**n**i*std â€‹ æ—¶è¯¥é¡¹ä¸º 0.9;0.9; ğ‘™ğ‘’ğ‘›ğ‘–sub >2.5ğ‘™ğ‘’ğ‘›ğ‘–std *l**e**n**i*sub â€‹>2.5*l**e**n**i*std â€‹ æ—¶è¯¥é¡¹ä¸º 0.75 ã€‚


## å‘ç°

ä¸­å›½ä¿¡æ¯é€šä¿¡ç ”ç©¶é™¢åœ°å€ï¼šåŒ—äº¬å¸‚æµ·æ·€åŒºèŠ±å›­åŒ—è·¯52å·é‚®æ”¿ç¼–ç ï¼š100191è”ç³»ç”µè¯ï¼š010-68094140ä¼ çœŸï¼š010-62304980ç½‘å€ï¼šwww.caict.ac.cn

è¿™äº›æ•°æ®è²Œä¼¼å’Œæé—®æ— å…³ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œæ–‡æœ¬å‰”é™¤



æœ‰ä»€ä¹ˆå‚æ•°å¯ä»¥æ§åˆ¶å›ç­”çš„é•¿åº¦ï¼Œå¢å¼ºå›ç­”çš„å‡†ç¡®åº¦



æ•°æ®